# Convert Studio Backend Configuration

# Server
ENVIRONMENT=production
PORT=8080
LOG_LEVEL=info

# Database
# Local (Docker): use default below
# Supabase (direct connection): Get from Supabase Dashboard > Settings > Database > Connection string > URI
# Use sslmode=require and URL-encode the password if it contains special characters
# Example: postgresql://postgres:[YOUR-PASSWORD]@db.[PROJECT-REF].supabase.co:5432/postgres?sslmode=require
DATABASE_URL=postgres://postgres:postgres@localhost:5432/convert_studio?sslmode=disable
REDIS_URL=localhost:6379

# Storage (local - files stored in STORAGE_BASE_PATH)
# All media is permanently deleted after 24 hours or when user deletes
STORAGE_BACKEND=local
STORAGE_BASE_PATH=./data

# For cloud storage (S3-compatible):
# STORAGE_BACKEND=s3
# S3_ENDPOINT=https://s3.amazonaws.com
# S3_BUCKET=your-bucket
# S3_ACCESS_KEY=your-key
# S3_SECRET_KEY=your-secret
# S3_REGION=us-east-1

# FFmpeg Configuration
FFMPEG_PATH=ffmpeg
FFPROBE_PATH=ffprobe

# =============================================================================
# FFmpeg Performance Settings (Cloud Server Optimized)
# =============================================================================

# Max threads per FFmpeg process
# 0 = auto (uses all available cores per job)
# Recommended for cloud: Set based on your VM size and WORKER_CONCURRENCY
# Formula: FFMPEG_MAX_THREADS = (VM_CORES / WORKER_CONCURRENCY)
# Example: 4-core VM with 2 workers = 2 threads each
FFMPEG_MAX_THREADS=0

# Hardware acceleration
# false = software encoding (works everywhere, uses CPU)
# true = try hardware encoding (requires GPU instance with NVENC/VAAPI)
# 
# Cloud GPU options:
# - AWS: p3/g4 instances with NVIDIA GPU → set true, FFmpeg uses NVENC
# - GCP: GPU instances → set true
# - Most standard VMs → keep false
FFMPEG_HARDWARE_ACCEL=false

# Encoding preset speed
# true = "veryfast" preset (faster encoding, ~10-20% larger files)
# false = "medium" preset (slower encoding, smaller files)
# 
# Recommended: true for better throughput and lower CPU time costs
FFMPEG_FAST_PRESETS=true

# =============================================================================
# Worker Configuration
# =============================================================================

# Number of concurrent video processing jobs
# Higher = more throughput but more CPU/memory usage
# Recommended: 1-2 per CPU core (e.g., 4-core VM = 2-4 workers)
WORKER_CONCURRENCY=2

# Security & Authentication (Clerk)
# Get these from https://dashboard.clerk.com
CLERK_SECRET_KEY=pk_live_Y2xlcmsudW5pc29uYWkubmV0JA

ALLOWED_ORIGINS=https://your-frontend-domain.com

# Limits
MAX_UPLOAD_SIZE=5368709120
MAX_JOBS_PER_USER=20

# Stripe (subscriptions)
# Create products/prices at https://dashboard.stripe.com/products
STRIPE_SECRET_KEY=sk_test_xxx
STRIPE_WEBHOOK_SECRET=whsec_xxx
STRIPE_BASIC_PRICE_ID=price_xxx
STRIPE_STANDARD_PRICE_ID=price_xxx
STRIPE_PRO_PRICE_ID=price_xxx
STRIPE_SUCCESS_URL=http://localhost:5173/pricing?success=true
STRIPE_CANCEL_URL=http://localhost:5173/pricing
